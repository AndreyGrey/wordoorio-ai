<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordoorio - –ê–Ω–∞–ª–∏–∑ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –æ–Ω–ª–∞–π–Ω | –ò–∑—É—á–µ–Ω–∏–µ –ª–µ–∫—Å–∏–∫–∏ –∏ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="shortcut icon" href="/static/favicon.ico">

    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="/static/js/Auth.js"></script>
    <script src="/static/components/Header.js"></script>
    <script src="/static/components/AnalysisForm.js"></script>
    <script src="/static/components/HighlightCard.js?v=6.0"></script>
    <script src="/static/js/HighlightsStorage.js"></script>
    <script src="/static/js/DictionaryAPI.js"></script>
    <script>
        // –ò–Ω—ä–µ–∫—Ü–∏—è —Å—Ç–∏–ª–µ–π HighlightCard
        document.addEventListener('DOMContentLoaded', function() {
            const highlightStyles = document.createElement('style');
            highlightStyles.innerHTML = getHighlightCardStyles();
            document.head.appendChild(highlightStyles);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ header
            initUnifiedHeader('header-container');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –∞–Ω–∞–ª–∏–∑–∞
            initAnalysisForm('form-container', {
                placeholder: 'Paste your English text here for analysis...',
                subtitle: 'AI-powered analysis discovers expressive vocabulary and linguistic patterns'
            });
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Manrope:wght@400;600;700;800&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(90deg, #39A0B3 0%, #1B7A94 100%);
            min-height: 100vh;
            color: #2d3748;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .results {
            background: transparent;
            padding: 40px 20px;
            display: none;
        }

        .results h2 {
            color: white;
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .highlight-item { 
            background: #ffffff; 
            padding: 24px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            border-left: 4px solid #4CAF50; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
        }
        
        .highlight-item:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .highlight-word { 
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #2d3748; 
            margin-bottom: 8px;
        }
        
        .highlight-translation {
            color: #4CAF50;
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .highlight-meaning {
            color: #4a5568;
            font-size: 0.95rem;
            margin-bottom: 12px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }
        
        .highlight-context { 
            color: #718096; 
            font-style: italic; 
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .highlighted-word {
            background: linear-gradient(135deg, #4CAF50 0%, #45A049 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-style: normal;
        }
        
        .highlight-examples {
            margin-top: 12px;
            padding: 10px;
            background: #f8fafc;
            border-left: 3px solid #10b981;
            border-radius: 0 4px 4px 0;
        }
        
        .english-example, .russian-example {
            margin: 6px 0;
            font-style: italic;
            color: #374151;
            line-height: 1.5;
        }
        
        .english-example {
            font-size: 14px;
        }
        
        .russian-example {
            font-size: 13px;
            color: #6b7280;
        }

        /* ===== –ù–û–í–´–ô –î–ò–ó–ê–ô–ù HIGHLIGHT CARD ===== */
        /* –°—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ HighlightCard –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ /static/components/HighlightCard.js */

        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Unified Header -->
    <div id="header-container"></div>

    <div class="container">
        <!-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ –∞–Ω–∞–ª–∏–∑–∞ -->
        <div id="form-container"></div>

        <div id="results" class="results">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
            <div id="highlightsList"></div>
        </div>
    </div>


    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –≤ LoadingAnimation.js

        async function analyzeText() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            const button = document.querySelector('.form-button');
            const errorDiv = document.getElementById('error');
            const resultsDiv = document.getElementById('results');

            if (!text) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                return;
            }

            button.disabled = true;
            button.textContent = 'ANALYZING...';
            errorDiv.style.display = 'none';
            resultsDiv.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
            showLoadingAnimation(text);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();

                if (data.success) {
                    showResults(data);
                } else {
                    showError(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
                hideLoadingAnimation();

                button.disabled = false;
                button.textContent = 'WORDOORIO!';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showResults(data) {
            console.log('Full response data:', JSON.stringify(data, null, 2));

            const highlightsList = document.getElementById('highlightsList');
            highlightsList.innerHTML = `<p style="color:rgba(255,255,255,0.9);margin-bottom:24px;text-align:center;font-size:1rem;font-weight:500;">–ù–∞–π–¥–µ–Ω–æ ${data.stats.total_highlights} —Ö–∞–π–ª–∞–π—Ç–æ–≤ –∏–∑ ${data.stats.total_words} —Å–ª–æ–≤</p>`;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Å–æ–∑–¥–∞–µ–º/–ø–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é
            const storage = new HighlightsStorage();
            const textInput = document.getElementById('textInput').value.trim();

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            const sessionId = storage.createSession(textInput, 'main');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–µ—à
            storage.saveLastAnalysis(sessionId, 'main', data.highlights);

            data.highlights.forEach((highlight, index) => {
                console.log(`Processing highlight ${index + 1}:`, highlight);

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç HighlightCard v6 —Å –∫–Ω–æ–ø–∫–∞–º–∏
                const cardHTML = createHighlightCard(highlight, index, 'orange', true);

                // –°–æ–∑–¥–∞–µ–º div –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º HTML –∫–∞—Ä—Ç–æ—á–∫–∏
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = cardHTML;
                highlightsList.appendChild(tempDiv.firstElementChild);
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏ (hover/click –¥–ª—è –∫–Ω–æ–ø–æ–∫)
            initHighlightCardInteractions();

            document.getElementById('results').style.display = 'block';
        }

        // Callback –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
        window.onHighlightSaved = async function(index) {
            const storage = new HighlightsStorage();
            const analysis = storage.getLastAnalysis();

            if (!analysis) {
                console.error('No active analysis session');
                showNotification('–û—à–∏–±–∫–∞: –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏', 'error');
                return;
            }

            const highlight = analysis.highlights[index];

            // –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –≤ localStorage
            storage.saveHighlight(analysis.session_id, highlight);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
            showNotification('‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');

            // –ü—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
            // –î–æ–±–∞–≤–ª—è–µ–º page_id –∫ highlight –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ analyses
            const highlightWithPageId = {
                ...highlight,
                page_id: analysis.session_id  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ–∫—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (session_id)
            };
            const result = await addToDictionary(highlightWithPageId);

            if (result.success) {
                console.log('‚úì –°–ª–æ–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            } else if (result.require_auth) {
                // –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                console.log('‚ÑπÔ∏è –°–ª–æ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.');
            } else {
                // –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏
                console.warn('‚ö†Ô∏è –°–ª–æ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:', result.error);
            }
        };

        // Callback –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
        window.onHighlightDeleted = function(index) {
            const storage = new HighlightsStorage();
            storage.markAsDeleted(index);
            console.log(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${index} —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏`);
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'success') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${type === 'error' ? '#fed7d7' : '#c6f6d5'};
                color: ${type === 'error' ? '#c53030' : '#22543d'};
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(notification);

            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 1500);
        }

        // –ê–Ω–∞–ª–∏–∑ –ø–æ Ctrl+Enter (–¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã)
        const textInput = document.getElementById('textInput');
        if (textInput) {
            textInput.addEventListener('keypress', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    analyzeText();
                }
            });
        }
    </script>

    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç LoadingAnimation - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="/static/components/LoadingAnimation.js?v=1.1"></script>
</body>
</html>