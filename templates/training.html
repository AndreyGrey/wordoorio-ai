<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ | Wordoorio</title>

    <!-- CSS —Å–∏—Å—Ç–µ–º–∞ -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/components.css">

    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="/static/js/Auth.js"></script>
    <script src="/static/components/Header.js"></script>

    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
        .training-header {
            text-align: center;
            color: var(--color-text-white);
            margin-bottom: var(--spacing-8);
        }

        .training-card {
            max-width: 600px;
            margin: 0 auto;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .word-display {
            text-align: center;
            padding: var(--spacing-10) var(--spacing-6);
            background: linear-gradient(135deg, #f7fafc 0%, #ffffff 100%);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-6);
            position: relative;
        }

        .word-display::before {
            content: 'üéì';
            position: absolute;
            top: var(--spacing-4);
            left: var(--spacing-4);
            font-size: 1.5rem;
            opacity: 0.3;
        }

        .word-en {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--spacing-3);
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .word-type {
            display: inline-block;
            font-size: var(--font-size-xs);
            color: var(--color-text-white);
            background: var(--gradient-primary);
            padding: var(--spacing-1) var(--spacing-3);
            border-radius: var(--radius-pill);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: var(--font-weight-semibold);
        }

        .progress-bar {
            background: var(--color-bg-light);
            height: 10px;
            border-radius: var(--radius-pill);
            overflow: hidden;
            margin-bottom: var(--spacing-4);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            color: var(--color-text-white);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-6);
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.5px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .option-btn {
            padding: var(--spacing-5) var(--spacing-6);
            border: 2px solid var(--color-border-light);
            border-radius: var(--radius-lg);
            background: var(--color-bg-white);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: var(--font-size-md);
            text-align: left;
            color: var(--color-text-primary);
            font-weight: var(--font-weight-medium);
            position: relative;
            opacity: 0;
            animation: fadeInOption 0.4s ease-out forwards;
        }

        @keyframes fadeInOption {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .option-btn:nth-child(1) { animation-delay: 0.1s; }
        .option-btn:nth-child(2) { animation-delay: 0.2s; }
        .option-btn:nth-child(3) { animation-delay: 0.3s; }
        .option-btn:nth-child(4) { animation-delay: 0.4s; }

        .option-btn:hover:not(:disabled) {
            border-color: var(--color-primary);
            background: var(--color-bg-light);
            transform: translateX(4px) scale(1.02);
            box-shadow: var(--shadow-md);
        }

        .option-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .option-btn.correct {
            border-color: var(--color-primary);
            background: var(--color-success);
            color: var(--color-success-text);
            animation: successPulse 0.6s ease;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-btn.incorrect {
            border-color: #e53e3e;
            background: var(--color-error);
            color: var(--color-error-text);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .result-feedback {
            text-align: center;
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-6);
            font-weight: var(--font-weight-semibold);
            animation: slideUp 0.3s ease-out;
            border: 2px solid transparent;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-feedback.correct {
            background: var(--color-success);
            color: var(--color-success-text);
            border-color: var(--color-primary);
        }

        .result-feedback.incorrect {
            background: var(--color-error);
            color: var(--color-error-text);
            border-color: #e53e3e;
        }

        .feedback-icon {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-3);
            display: block;
        }

        .feedback-message {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-2);
        }

        .feedback-submessage {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }

        .word-stats {
            display: flex;
            justify-content: space-around;
            margin-top: var(--spacing-4);
            padding-top: var(--spacing-4);
            border-top: 2px solid var(--color-border-light);
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            display: block;
        }

        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            display: block;
            margin-top: var(--spacing-1);
        }

        .completion-screen {
            text-align: center;
            padding: var(--spacing-12) var(--spacing-6);
            animation: fadeInUp 0.6s ease-out;
        }

        .completion-icon {
            font-size: 5rem;
            margin-bottom: var(--spacing-6);
            animation: celebration 1s ease-out;
            display: inline-block;
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(10deg); }
            75% { transform: scale(1.2) rotate(-10deg); }
        }

        .completion-title {
            font-size: var(--font-size-2xl);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-3);
        }

        .completion-subtitle {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-6);
        }

        .completion-stats {
            background: linear-gradient(135deg, #f7fafc 0%, #ffffff 100%);
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
            margin: var(--spacing-6) 0;
            border: 2px solid var(--color-border-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
            margin-top: var(--spacing-4);
        }

        .stat-box {
            padding: var(--spacing-4);
            background: var(--color-bg-white);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border-light);
        }

        .stat-box-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            display: block;
        }

        .stat-box-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            margin-top: var(--spacing-2);
        }

        .completion-message {
            background: var(--color-success);
            color: var(--color-success-text);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            margin: var(--spacing-6) 0;
            font-weight: var(--font-weight-medium);
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-16) var(--spacing-6);
            animation: fadeInUp 0.6s ease-out;
        }

        .empty-state-icon {
            font-size: 5rem;
            margin-bottom: var(--spacing-6);
            animation: float 3s ease-in-out infinite;
            display: inline-block;
        }

        .empty-state h2 {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-4);
        }

        .empty-state-subtitle {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-3);
            font-weight: var(--font-weight-medium);
        }

        .empty-state-description {
            color: var(--color-text-muted);
            font-size: var(--font-size-base);
            margin: var(--spacing-6) auto;
            max-width: 400px;
            line-height: var(--line-height-relaxed);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-state {
            text-align: center;
            padding: var(--spacing-12) var(--spacing-6);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto var(--spacing-6);
            border: 4px solid var(--color-bg-light);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-3);
        }

        .loading-subtitle {
            font-size: var(--font-size-base);
            color: var(--color-text-muted);
            margin-bottom: var(--spacing-6);
        }

        .loading-tips {
            background: var(--color-bg-light);
            padding: var(--spacing-5);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-6);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            line-height: var(--line-height-relaxed);
        }

        @media (max-width: 768px) {
            .training-header h1 {
                font-size: var(--font-size-xl);
            }

            .training-header p {
                font-size: var(--font-size-sm);
            }

            .training-card {
                padding: var(--spacing-5);
            }

            .word-display {
                padding: var(--spacing-6) var(--spacing-4);
            }

            .word-en {
                font-size: var(--font-size-2xl);
            }

            .option-btn {
                padding: var(--spacing-4) var(--spacing-5);
                font-size: var(--font-size-base);
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-3);
            }

            .stat-box {
                padding: var(--spacing-3);
            }

            .completion-icon {
                font-size: 4rem;
            }

            .completion-title {
                font-size: var(--font-size-xl);
            }

            .completion-subtitle {
                font-size: var(--font-size-base);
            }

            .empty-state {
                padding: var(--spacing-12) var(--spacing-4);
            }

            .empty-state-icon {
                font-size: 4rem;
            }

            .empty-state h2 {
                font-size: var(--font-size-xl);
            }

            .loading-spinner {
                width: 50px;
                height: 50px;
            }

            .loading-title {
                font-size: var(--font-size-lg);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div id="header-container"></div>

    <div class="container">
        <div class="training-header">
            <h1>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–ª–æ–≤</h1>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤</p>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <div id="progress-container" style="display: none;">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text" class="progress-text">–¢–µ—Å—Ç 0 –∏–∑ 0</div>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="training-card" class="card card-lg training-card" style="display: none;">
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞ -->
            <div class="word-display">
                <div id="word-english" class="word-en">...</div>
                <div id="word-type" class="word-type"></div>
            </div>

            <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
            <div id="options-container" class="options-container">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–±–∞–≤—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–≤–µ—Ç–∞ -->
            <div id="result-feedback" class="result-feedback" style="display: none;">
                <div id="feedback-text"></div>
                <div class="word-stats">
                    <div class="stat">
                        <span class="stat-label">–†–µ–π—Ç–∏–Ω–≥</span>
                        <span id="stat-rating" class="stat-value">-</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">–°—Ç–∞—Ç—É—Å</span>
                        <span id="stat-status" class="stat-value">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
        <div id="completion-screen" class="card card-lg training-card completion-screen" style="display: none;">
            <div class="completion-icon">üéâ</div>
            <h2 class="completion-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
            <p class="completion-subtitle">–¢—ã –ø—Ä–æ—à–µ–ª –≤—Å–µ 8 —Ç–µ—Å—Ç–æ–≤</p>

            <div class="completion-stats">
                <div class="stats-grid">
                    <div class="stat-box">
                        <span id="correct-count" class="stat-box-value">0</span>
                        <div class="stat-box-label">‚úÖ –í–µ—Ä–Ω–æ</div>
                    </div>
                    <div class="stat-box">
                        <span id="incorrect-count" class="stat-box-value">0</span>
                        <div class="stat-box-label">‚ùå –û—à–∏–±–æ–∫</div>
                    </div>
                    <div class="stat-box">
                        <span id="accuracy-percent" class="stat-box-value">0%</span>
                        <div class="stat-box-label">üìä –¢–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
            </div>

            <div id="completion-message" class="completion-message"></div>

            <button id="restart-btn" class="btn btn-primary btn-lg">–ï—â–µ —Ä–∞—É–Ω–¥! üöÄ</button>
        </div>

        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ / –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="empty-state" class="card card-lg training-card empty-state">
            <div class="empty-state-icon">üéØ</div>
            <h2>–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–≤–æ–∏ –∑–Ω–∞–Ω–∏—è?</h2>
            <p class="empty-state-subtitle">8 —Å–ª–æ–≤, 2 –º–∏–Ω—É—Ç—ã, –º–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑—ã</p>
            <p class="empty-state-description">
                –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–µ—Ä–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
            </p>
            <button id="start-btn" class="btn btn-primary btn-lg">–ü–æ–µ—Ö–∞–ª–∏!</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—ç–¥–µ—Ä–∞
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof initUnifiedHeader === 'function') {
                initUnifiedHeader('header-container');
            }
        });

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let currentTraining = null;
        let currentTestIndex = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const emptyState = document.getElementById('empty-state');
        const trainingCard = document.getElementById('training-card');
        const completionScreen = document.getElementById('completion-screen');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const wordEnglish = document.getElementById('word-english');
        const wordType = document.getElementById('word-type');
        const optionsContainer = document.getElementById('options-container');
        const resultFeedback = document.getElementById('result-feedback');
        const feedbackText = document.getElementById('feedback-text');
        const statRating = document.getElementById('stat-rating');
        const statStatus = document.getElementById('stat-status');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            const user = await checkAuth();
            if (!user) {
                emptyState.innerHTML = `
                    <div class="empty-state-icon">!</div>
                    <h2>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                    <p style="color: var(--color-text-muted); margin: var(--spacing-6) 0;">
                        –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                    </p>
                    <a href="/" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                `;
                return;
            }
        });

        // –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        startBtn.addEventListener('click', startTraining);
        restartBtn.addEventListener('click', startTraining);

        async function startTraining() {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
                const tips = [
                    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç: –∏–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –≤ –º–æ–∑–≥–µ',
                    '–°–æ–≤–µ—Ç: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º –∑—É–±—Ä–µ–∂–∫–∞',
                    '–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã? –°—Ä–µ–¥–Ω–∏–π –Ω–æ—Å–∏—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∑–Ω–∞–µ—Ç 20,000-35,000 —Å–ª–æ–≤',
                    '–§–∞–∫—Ç: –∏–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ —É–ª—É—á—à–∞–µ—Ç –ø–∞–º—è—Ç—å –∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏'
                ];
                const randomTip = tips[Math.floor(Math.random() * tips.length)];

                emptyState.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <h3 class="loading-title">–ì–æ—Ç–æ–≤–∏–º —Ç–≤–æ–∏ —Ç–µ—Å—Ç—ã...</h3>
                        <p class="loading-subtitle">–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –ø–æ–¥–±–∏—Ä–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</p>
                        <div class="loading-tips">üí° ${randomTip}</div>
                    </div>
                `;

                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è timeout 30 —Å–µ–∫—É–Ω–¥
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const response = await fetch('/api/training/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏');
                }

                currentTraining = data;
                currentTestIndex = 0;
                correctAnswers = 0;
                incorrectAnswers = 0;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                emptyState.style.display = 'none';
                completionScreen.style.display = 'none';
                trainingCard.style.display = 'block';
                progressContainer.style.display = 'block';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç
                showTest();

            } catch (error) {
                emptyState.innerHTML = `
                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                    <h2>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h2>
                    <p class="empty-state-description">${error.message}</p>
                    <button id="retry-btn" class="btn btn-primary btn-lg">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                `;
                document.getElementById('retry-btn').addEventListener('click', startTraining);
            }
        }

        function showTest() {
            if (!currentTraining || currentTestIndex >= currentTraining.tests.length) {
                showCompletion();
                return;
            }

            const test = currentTraining.tests[currentTestIndex];

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = ((currentTestIndex + 1) / currentTraining.tests.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `–¢–µ—Å—Ç ${currentTestIndex + 1} –∏–∑ ${currentTraining.tests.length}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ–≤–æ
            wordEnglish.textContent = test.word;

            // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ç–∏–ø—ã —Å–ª–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
            const typeTranslations = {
                'noun': '—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ',
                'verb': '–≥–ª–∞–≥–æ–ª',
                'adjective': '–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ',
                'adverb': '–Ω–∞—Ä–µ—á–∏–µ',
                'pronoun': '–º–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ',
                'preposition': '–ø—Ä–µ–¥–ª–æ–≥',
                'conjunction': '—Å–æ—é–∑',
                'interjection': '–º–µ–∂–¥–æ–º–µ—Ç–∏–µ'
            };
            const russianType = test.type ? (typeTranslations[test.type.toLowerCase()] || test.type) : '';
            wordType.textContent = russianType;

            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞
            resultFeedback.style.display = 'none';

            // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            optionsContainer.innerHTML = '';
            test.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.text;
                btn.onclick = () => submitAnswer(test.test_id, option.text, btn);
                optionsContainer.appendChild(btn);
            });
        }

        async function submitAnswer(testId, selectedOption, buttonElement) {
            try {
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
                const allButtons = optionsContainer.querySelectorAll('.option-btn');
                allButtons.forEach(btn => btn.disabled = true);

                const response = await fetch('/api/training/answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    body: JSON.stringify({
                        test_id: testId,
                        answer: selectedOption
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞');
                }

                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (result.is_correct) {
                    correctAnswers++;
                } else {
                    incorrectAnswers++;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç–º–æ—Ü–∏—è–º–∏
                if (result.is_correct) {
                    buttonElement.classList.add('correct');
                    resultFeedback.className = 'result-feedback correct';

                    const encouragements = [
                        { icon: 'üéâ', text: '–û—Ç–ª–∏—á–Ω–æ!', sub: '–¢—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏!' },
                        { icon: '‚ú®', text: '–°—É–ø–µ—Ä!', sub: '–ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!' },
                        { icon: 'üî•', text: '–û–≥–æ–Ω—å!', sub: '–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!' },
                        { icon: 'üí™', text: '–ö–ª–∞—Å—Å!', sub: '–£ —Ç–µ–±—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è!' },
                        { icon: 'üåü', text: '–í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ!', sub: '–¢—ã –º–æ–ª–æ–¥–µ—Ü!' }
                    ];
                    const random = encouragements[Math.floor(Math.random() * encouragements.length)];

                    feedbackText.innerHTML = `
                        <span class="feedback-icon">${random.icon}</span>
                        <div class="feedback-message">${random.text}</div>
                        <div class="feedback-submessage">${random.sub}</div>
                    `;
                } else {
                    buttonElement.classList.add('incorrect');
                    resultFeedback.className = 'result-feedback incorrect';

                    const supports = [
                        { icon: 'üí°', text: '–ü–æ—á—Ç–∏!', sub: '–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, —É—á–∏–º—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö' },
                        { icon: 'üéØ', text: '–ù–µ —Å—Ç—Ä–∞—à–Ω–æ!', sub: '–í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ —Ç–æ—á–Ω–æ –ø–æ–ª—É—á–∏—Ç—Å—è' },
                        { icon: 'üìö', text: '–ë—ã–≤–∞–µ—Ç!', sub: '–ì–ª–∞–≤–Ω–æ–µ ‚Äî –∑–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç' }
                    ];
                    const random = supports[Math.floor(Math.random() * supports.length)];

                    feedbackText.innerHTML = `
                        <span class="feedback-icon">${random.icon}</span>
                        <div class="feedback-message">${random.text}</div>
                        <div class="feedback-submessage">${random.sub}</div>
                        <div style="margin-top: var(--spacing-4); padding: var(--spacing-3); background: rgba(255,255,255,0.2); border-radius: var(--radius-md);">
                            <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> ${result.correct_translation}
                        </div>
                    `;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statusNames = {
                    'new': 'üÜï –ù–æ–≤–æ–µ',
                    'learning': 'üìñ –£—á—É',
                    'learned': '‚úÖ –í—ã—É—á–µ–Ω–æ'
                };
                statRating.textContent = `${result.new_rating}/10`;
                statStatus.textContent = statusNames[result.new_status] || result.new_status;
                resultFeedback.style.display = 'block';

                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ç–µ—Å—Ç—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    currentTestIndex++;
                    showTest();
                }, 2000);

            } catch (error) {
                alert(error.message);
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                const allButtons = optionsContainer.querySelectorAll('.option-btn');
                allButtons.forEach(btn => btn.disabled = false);
            }
        }

        function showCompletion() {
            trainingCard.style.display = 'none';
            progressContainer.style.display = 'none';
            completionScreen.style.display = 'block';

            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const total = correctAnswers + incorrectAnswers;
            const accuracy = total > 0 ? Math.round((correctAnswers / total) * 100) : 0;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('correct-count').textContent = correctAnswers;
            document.getElementById('incorrect-count').textContent = incorrectAnswers;
            document.getElementById('accuracy-percent').textContent = accuracy + '%';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const messageEl = document.getElementById('completion-message');
            if (accuracy === 100) {
                messageEl.innerHTML = 'üèÜ <strong>–ò–¥–µ–∞–ª—å–Ω–æ!</strong> –¢—ã –∑–Ω–∞–µ—à—å –≤—Å–µ —Å–ª–æ–≤–∞ –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!';
            } else if (accuracy >= 75) {
                messageEl.innerHTML = 'üåü <strong>–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</strong> –¢—ã –±–æ–ª—å—à–æ–π –º–æ–ª–æ–¥–µ—Ü, –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!';
            } else if (accuracy >= 50) {
                messageEl.innerHTML = 'üí™ <strong>–•–æ—Ä–æ—à–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å!</strong> –¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ‚Äî –º–∞—Ç—å —É—á–µ–Ω–∏—è!';
            } else {
                messageEl.innerHTML = 'üìö <strong>–ù–∞—á–∞–ª–æ –ø–æ–ª–æ–∂–µ–Ω–æ!</strong> –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è, —Å –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π –±—É–¥–µ—Ç –ª—É—á—à–µ!';
            }
        }
    </script>
</body>
</html>
