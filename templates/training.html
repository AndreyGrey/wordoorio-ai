<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ | Wordoorio</title>

    <!-- CSS —Å–∏—Å—Ç–µ–º–∞ -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/components.css">

    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="/static/js/Auth.js"></script>
    <script src="/static/components/Header.js"></script>

    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
        .container {
            padding-top: var(--spacing-6);
            padding-bottom: var(--spacing-10);
        }

        .training-header {
            text-align: center;
            margin-bottom: var(--spacing-6);
        }

        .training-header h1 {
            color: white;
            font-size: 1.875rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .training-card {
            max-width: 600px;
            margin: 0 auto;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .word-display {
            text-align: center;
            padding: var(--spacing-6) var(--spacing-4);
            background: linear-gradient(135deg, #f7fafc 0%, #ffffff 100%);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-6);
            position: relative;
        }

        .word-display::before {
            content: '';
            display: none;
        }

        .word-en {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }


        .progress-bar {
            background: var(--color-bg-light);
            height: 10px;
            border-radius: var(--radius-pill);
            overflow: hidden;
            margin-bottom: var(--spacing-4);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            color: var(--color-text-white);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-6);
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.5px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .additional-meanings {
            margin-top: var(--spacing-4);
            padding: var(--spacing-3) var(--spacing-4);
            background: var(--color-bg-light);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            animation: fadeIn 0.3s ease-out;
        }

        .additional-meanings-label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .option-btn {
            padding: var(--spacing-5) var(--spacing-6);
            border: 2px solid var(--color-border-light);
            border-radius: var(--radius-lg);
            background: var(--color-bg-white);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: var(--font-size-md);
            text-align: left;
            color: var(--color-text-primary);
            font-weight: var(--font-weight-medium);
            position: relative;
            opacity: 0;
            animation: fadeInOption 0.4s ease-out forwards;
        }

        @keyframes fadeInOption {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .option-btn:nth-child(1) { animation-delay: 0.1s; }
        .option-btn:nth-child(2) { animation-delay: 0.2s; }
        .option-btn:nth-child(3) { animation-delay: 0.3s; }
        .option-btn:nth-child(4) { animation-delay: 0.4s; }

        .option-btn:hover:not(:disabled) {
            border-color: var(--color-primary);
            background: var(--color-bg-light);
            transform: translateX(4px) scale(1.02);
            box-shadow: var(--shadow-md);
        }

        .option-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .option-btn.correct {
            border-color: var(--color-primary);
            border-width: 3px;
            background: var(--color-success);
            color: var(--color-success-text);
            animation: successPulse 0.6s ease;
            font-weight: var(--font-weight-semibold);
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-btn.incorrect {
            border-color: #e53e3e;
            border-width: 3px;
            background: var(--color-error);
            color: var(--color-error-text);
            animation: shake 0.5s ease;
            font-weight: var(--font-weight-semibold);
        }

        .option-btn.blurred {
            opacity: 0.3;
            filter: blur(2px);
            pointer-events: none;
        }

        /* –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è correct –∏ incorrect - –æ–Ω–∏ –ù–ï –¥–æ–ª–∂–Ω—ã –±–ª—é—Ä–∏—Ç—å—Å—è */
        .option-btn.correct,
        .option-btn.incorrect {
            opacity: 1 !important;
            filter: none !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }


        .option-btn:disabled {
            cursor: not-allowed;
        }


        .completion-screen {
            text-align: center;
            padding: var(--spacing-8) var(--spacing-6);
            animation: fadeInUp 0.6s ease-out;
        }

        .completion-title {
            font-size: var(--font-size-xl);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-6);
        }

        .completion-stats {
            margin: var(--spacing-6) 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .stat-box {
            padding: var(--spacing-4);
            background: var(--color-bg-light);
            border-radius: var(--radius-md);
        }

        .stat-box-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            display: block;
            margin-bottom: var(--spacing-1);
        }

        .stat-box-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-12) var(--spacing-6);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-state {
            text-align: center;
            padding: var(--spacing-12) var(--spacing-6);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto var(--spacing-6);
            border: 4px solid var(--color-bg-light);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-3);
        }

        .loading-subtitle {
            font-size: var(--font-size-base);
            color: var(--color-text-muted);
            margin-bottom: var(--spacing-6);
        }

        .loading-tips {
            margin-top: var(--spacing-6);
            height: 80px;
            overflow: hidden;
            position: relative;
        }

        .loading-tip {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            line-height: var(--line-height-relaxed);
            font-style: italic;
            text-align: center;
            padding: var(--spacing-2) var(--spacing-4);
            opacity: 0;
            position: absolute;
            width: 100%;
            animation: rotateTip 12s infinite;
            max-width: 600px;
            left: 50%;
            transform: translateX(-50%);
        }

        .loading-tip:nth-child(1) { animation-delay: 0s; }
        .loading-tip:nth-child(2) { animation-delay: 4s; }
        .loading-tip:nth-child(3) { animation-delay: 8s; }

        @keyframes rotateTip {
            0%, 33.33% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            36.33%, 63.33% { opacity: 1; transform: translateX(-50%) translateY(0); }
            66.33%, 100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        /* Header container - —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º –º–µ—Å—Ç–æ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ JS */
        #header-container {
            min-height: 104px;
        }

        #header-container:empty::before {
            content: '';
            display: block;
            height: 104px;
        }

        @media (max-width: 640px) {
            #header-container {
                min-height: 76px;
            }

            #header-container:empty::before {
                height: 76px;
            }
        }

        @media (max-width: 480px) {
            #header-container {
                min-height: 68px;
            }

            #header-container:empty::before {
                height: 68px;
            }
        }

        @media (max-width: 768px) {
            .training-header h1 {
                font-size: var(--font-size-xl);
            }

            .training-header p {
                font-size: var(--font-size-sm);
            }

            .training-card {
                padding: var(--spacing-5);
            }

            .word-display {
                padding: var(--spacing-6) var(--spacing-4);
            }

            .word-en {
                font-size: var(--font-size-2xl);
            }

            .option-btn {
                padding: var(--spacing-4) var(--spacing-5);
                font-size: var(--font-size-base);
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-3);
            }

            .stat-box {
                padding: var(--spacing-3);
            }

            .completion-icon {
                font-size: 4rem;
            }

            .completion-title {
                font-size: var(--font-size-xl);
            }

            .completion-subtitle {
                font-size: var(--font-size-base);
            }

            .empty-state {
                padding: var(--spacing-12) var(--spacing-4);
            }

            .empty-state-icon {
                font-size: 4rem;
            }

            .empty-state h2 {
                font-size: var(--font-size-xl);
            }

            .loading-spinner {
                width: 50px;
                height: 50px;
            }

            .loading-title {
                font-size: var(--font-size-lg);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div id="header-container"></div>

    <div class="container">
        <div class="training-header">
            <h1>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h1>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <div id="progress-container" style="display: none;">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text" class="progress-text">–¢–µ—Å—Ç 0 –∏–∑ 0</div>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="training-card" class="card card-lg training-card" style="display: none;">
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞ -->
            <div class="word-display">
                <div id="word-english" class="word-en">...</div>
            </div>

            <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
            <div id="options-container" class="options-container">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–±–∞–≤—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
        <div id="completion-screen" class="card card-lg training-card completion-screen" style="display: none;">
            <h2 class="completion-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>

            <div class="completion-stats">
                <div class="stats-grid">
                    <div class="stat-box">
                        <span id="correct-count" class="stat-box-value">0</span>
                        <div class="stat-box-label">–í–µ—Ä–Ω–æ</div>
                    </div>
                    <div class="stat-box">
                        <span id="incorrect-count" class="stat-box-value">0</span>
                        <div class="stat-box-label">–û—à–∏–±–æ–∫</div>
                    </div>
                    <div class="stat-box">
                        <span id="accuracy-percent" class="stat-box-value">0%</span>
                        <div class="stat-box-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
            </div>

            <button id="restart-btn" class="btn btn-primary btn-lg">–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
        </div>

        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ / –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="empty-state" class="card card-lg training-card empty-state">
            <button id="start-btn" class="btn btn-primary btn-lg">–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—ç–¥–µ—Ä–∞
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof initUnifiedHeader === 'function') {
                await initUnifiedHeader('header-container');
            }
        });

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let currentTraining = null;
        let currentTestIndex = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const emptyState = document.getElementById('empty-state');
        const trainingCard = document.getElementById('training-card');
        const completionScreen = document.getElementById('completion-screen');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const wordEnglish = document.getElementById('word-english');
        const optionsContainer = document.getElementById('options-container');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            const user = await checkAuth();
            if (!user) {
                emptyState.innerHTML = `
                    <div class="empty-state-icon">!</div>
                    <h2>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                    <p style="color: var(--color-text-muted); margin: var(--spacing-6) 0;">
                        –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                    </p>
                    <a href="/" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                `;
                return;
            }
        });

        // –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        startBtn.addEventListener('click', startTraining);
        restartBtn.addEventListener('click', startTraining);

        async function startTraining() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º completion screen –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º empty state –¥–ª—è loading
                completionScreen.style.display = 'none';
                trainingCard.style.display = 'none';
                emptyState.style.display = 'block';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —á–µ—Ä–µ–¥—É—é—â–∏–º–∏—Å—è —Ü–∏—Ç–∞—Ç–∞–º–∏
                const quotes = [
                    '"The limits of my language mean the limits of my world." ‚Äî Ludwig Wittgenstein',
                    '"One language sets you in a corridor for life. Two languages open every door." ‚Äî Frank Smith',
                    '"Language is the road map of a culture." ‚Äî Rita Mae Brown'
                ];

                emptyState.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <h3 class="loading-title">Generating tests...</h3>
                        <p class="loading-subtitle">AI is analyzing your vocabulary</p>
                        <div class="loading-tips">
                            ${quotes.map(quote => `<div class="loading-tip">${quote}</div>`).join('')}
                        </div>
                    </div>
                `;

                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è timeout 30 —Å–µ–∫—É–Ω–¥
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const response = await fetch('/api/training/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏');
                }

                currentTraining = data;
                currentTestIndex = 0;
                correctAnswers = 0;
                incorrectAnswers = 0;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                emptyState.style.display = 'none';
                completionScreen.style.display = 'none';
                trainingCard.style.display = 'block';
                progressContainer.style.display = 'block';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç
                showTest();

            } catch (error) {
                emptyState.innerHTML = `
                    <div class="empty-state-icon">!</div>
                    <h2>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h2>
                    <p class="empty-state-description">${error.message}</p>
                    <button id="retry-btn" class="btn btn-primary btn-lg">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                `;
                document.getElementById('retry-btn').addEventListener('click', startTraining);
            }
        }

        function showTest() {
            if (!currentTraining || currentTestIndex >= currentTraining.tests.length) {
                showCompletion();
                return;
            }

            const test = currentTraining.tests[currentTestIndex];

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = ((currentTestIndex + 1) / currentTraining.tests.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `–¢–µ—Å—Ç ${currentTestIndex + 1} –∏–∑ ${currentTraining.tests.length}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ–≤–æ
            wordEnglish.textContent = test.word;

            // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            optionsContainer.innerHTML = '';

            // –§–æ—Ä—Å–∏—Ä—É–µ–º reflow —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ CSS —Å–æ—Å—Ç–æ—è–Ω–∏—è
            void optionsContainer.offsetHeight;

            test.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.text;
                btn.dataset.isCorrect = option.is_correct;
                btn.onclick = () => submitAnswer(test, option, btn);
                optionsContainer.appendChild(btn);
            });
        }

        async function submitAnswer(test, selectedOption, buttonElement) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            const allButtons = optionsContainer.querySelectorAll('.option-btn');
            allButtons.forEach(btn => btn.disabled = true);

            const isCorrect = selectedOption.is_correct;

            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (isCorrect) {
                correctAnswers++;
            } else {
                incorrectAnswers++;
            }

            // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            const correctOption = test.options.find(opt => opt.is_correct);
            const correctButton = Array.from(allButtons).find(btn => btn.dataset.isCorrect === 'true');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ú–ì–ù–û–í–ï–ù–ù–û
            if (isCorrect) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥
                buttonElement.classList.add('correct');
                buttonElement.textContent = correctOption.text;
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç - –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫—Ä–∞—Å–Ω—ã–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π
                buttonElement.classList.add('incorrect');

                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∑–µ–ª–µ–Ω—ã–º —Å –≥–∞–ª–æ—á–∫–æ–π
                if (correctButton) {
                    correctButton.classList.add('correct');
                    correctButton.textContent = `‚úì ${correctOption.text}`;
                }
            }

            // –ë–ª—é—Ä–∏–º –í–°–ï –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–∫—Ä–æ–º–µ correct –∏ incorrect)
            allButtons.forEach(btn => {
                if (!btn.classList.contains('correct') && !btn.classList.contains('incorrect')) {
                    btn.classList.add('blurred');
                }
            });

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/training/answer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'same-origin',
                body: JSON.stringify({
                    test_id: test.test_id,
                    answer: selectedOption.text
                })
            }).then(response => {
                if (!response.ok) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞');
                    return;
                }
                return response.json();
            }).then(data => {
                if (data && data.additional_meanings && data.additional_meanings.length > 0) {
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                    const correctBtn = optionsContainer.querySelector('.correct');
                    if (correctBtn) {
                        const meaningsDiv = document.createElement('div');
                        meaningsDiv.className = 'additional-meanings';
                        meaningsDiv.innerHTML = `<span class="additional-meanings-label">üìñ –ê –µ—â—ë:</span> ${data.additional_meanings.join(', ')}`;
                        correctBtn.insertAdjacentElement('afterend', meaningsDiv);
                    }
                }
            }).catch(err => console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', err));

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ç–µ—Å—Ç—É —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                currentTestIndex++;
                showTest();
            }, 4000);
        }

        function showCompletion() {
            trainingCard.style.display = 'none';
            progressContainer.style.display = 'none';
            completionScreen.style.display = 'block';

            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const total = correctAnswers + incorrectAnswers;
            const accuracy = total > 0 ? Math.round((correctAnswers / total) * 100) : 0;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('correct-count').textContent = correctAnswers;
            document.getElementById('incorrect-count').textContent = incorrectAnswers;
            document.getElementById('accuracy-percent').textContent = accuracy + '%';
        }
    </script>
</body>
</html>
